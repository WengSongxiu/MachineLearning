# 金融大数据风控建模实战


## 1 金融科技
### 1.1 智能风控和评分卡

智能风控基于“大数据+人工智能技术”简历信用评估模型，提高风险管控能力。在金融领域，最核心的问题是风险控制。

个人信贷中信用风险评估的关键是，通过分析借款人的信用数据和其他相关数据，评估借款人的还款意愿和能力，从而量化违约风险。

评分卡模型包括：

- 申请评分卡
- 行为评分卡
- 催收评分卡
- 营销评分卡
- 客户流失评分卡
- 反欺诈模型

注：逾期与违约的含义不同，违约是严重的逾期行为，所以逾期用户一定是从违约发展而来的。

### 1.2 评分卡模型开发流程

![](https://github.com/WengSongxiu/MachineLearning/blob/master/image/%E8%AF%84%E5%88%86%E5%8D%A1%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.png)

#### 1.2.1 需求分析阶段

- 开发目标：需要弄清楚开发的评分卡种类，如申请评分卡、反欺诈模型、行为评分卡等。
- 开发周期：明确整个开发的周期，是否要划分不同开发周期，每个周期需要明确交付时间和交付内容。
- 数据情况：需要确定哪些数据可用、数据的时间范围、数据大小、存储格式、关联方式和数据质量。
- 交付方式：模型的上线方式决定了模型的最终交付形式和外部接口。
- 交付时间：明确评分卡的交付时间。
- 评估指标：明确模型评估指标，准确率、精确率、召回率、KS、TPR-FPR等。同时需要考虑评估指标之间的相互制约关系，如精确率和召回率是相互制约，在KS值固定的前提下，需要做取舍。
- 响应时间：需要考虑模型的响应时间。另外实时和离线的响应时间是不一样的，具体情况，具体分析。

#### 1.2.2 模型开发阶段

- **数据准备：**明确可用数据以及数据存储格式、数据来源、内部数据还是外部数据等，为建模做准备。另外还需要提前定义好坏样本时间窗口。
- **数据探索：**探索数据整体情况、特征分布、缺失情况和异常情况以及指标之间的相关性。可采用pandas_profiling生成数据探索报告。数据探索阶段需要初步明确特征工程的大概思路。
- **特征工程：**进行数据预处理、特征选择和特征变换和衍生等操作，提升数据质量，丰富数据维度。（注意：在评分卡模型中，一般缺失值不采用插补的方法，而是直接将缺失作为一种特征。）
- **模型训练：**可采用经典算法构建BASELINE看看数据的表现，然后结合评估指标分析是否需要调参或者特征工程优化。如果要求模型可解释性，即结合业务做解释，则尽量不使用黑盒模型，如集成模型和神经网络。应优先考虑Logistics回归模型或决策树等具有可解释性的模型。
- **模型评估：**模型评估指标一般有Precision/Recall/Acc/Mae/Mse等，但在金融风控领域，一般采用KS为主，再辅助参考其他评估指标。在金融风控评分卡模型中，KS > 0.4 认为模型可用。

![](https://github.com/WengSongxiu/MachineLearning/blob/master/image/ks.png)

- **评分卡创建：**将模型输出的概率转化为信用分，即风险数值化。

#### 1.2.3 上线部署与监控阶段

- 上线部署：明确部署方式，可执行程序部署、python脚本部署或者容器化部署，根据部署方式进行部署。
- 运营监控：监控模型稳定性、接口调用次数、平均调用时长、调用峰值等。

## 2 评分卡的分类

​	评分卡的分类主要包括申请评分卡、行为评分卡、催收评分卡和反欺诈评分卡。在贷前主要根据欺诈评分卡过滤可能欺诈的个人欺诈和群体欺诈，通过欺诈识别的用户才能开始申请评分卡，申请评分卡是贷前根据用户的还款意愿和还款能力评估用户的信用状态，从而决定给不给用户贷款以及贷款金额。由于数据的时效性以及外部环境的复杂性，在申请阶段无法完全精确评估用户的信用状态，所以在贷中也需要对用户的信用状态进行评估，因此行为评分卡相当于是申请评分卡的补充，也是对用户可能违约的预测。最后一个是催收评分卡，催收管理是一个非常复杂的系统，包括催收策略、催收服务、智能外呼、失联修复等方面，主要用于辅助催收。

- 欺诈评分卡：贷前根据用户基础信息、征信数据和第三方数据，预测用户贷款欺诈的得分。
- 申请评分卡：贷前根据用户基础信息、征信数据和第三方数据，评估用户的信用状态，预测用户贷款违约的得分。
- 行为评分卡：贷中根据用户的实时数据、基本信息、征信数据和第三方数据，评估用户的信用状态，预测用户贷款违约的得分。
- 催收评分卡：贷中根据用户的基本信息、征信数据和第三方数据，预测客户从轻度逾期到重度逾期的概率。

## 3 评分卡实战基础

### 3.1 数据预处理

#### 3.1.1 数据集成

​	在评分卡模型开发过程中往往需要考虑不同的数据源，如征信数据、平台数据、第三方数据等。每种数据源都有相应的数据格式规范，可能会出现数据格式不一致、单位不一致和数据冗余问题。数据集成就是将多源异构的数据构成一个统一的数据结构的过程。

四种数据种类：	

​	基本信息：性别、年龄、学历、收入、工作年限、工作单位、工作性质、是否有车、住房类型等。

​	信用数据：信用卡和其他借记卡逾期情况、房贷情况、车贷情况和社保数据（缴费基数、缴费单位和缴费年限）等。

​	消费数据：消费数据一般需要购买，如京东、淘宝等数据。包括月消费金额，购买产品类型等。

​	行为数据：行为数据一般需要购买，如运营商数据。包括流量使用情况、通话数据等。

四大数据特性：

​	数据完整性：数据不缺失

​	数据一致性：含义一致、单位一致

​	数据唯一性：无冗余

​	数据时效性：观察期/表现期

#### 3.1.2 数据清洗

​	数据清洗即清洗“脏数据”，包括数据源自身和数据集成后产生的数据格式不一致、单位不一致、数据冗余等问题。

特殊字符清洗：去除特殊字符，如空格、回车、转义字符等

数据格式转换：时间格式统一、时区的统一

数据概念统一：工作单位、户口所在地、居住地址等数据的统一

数据类型转换：如字符串类型的时间变量转为时间类型

样本去冗余

#### 3.1.3 探索性分析

​	通过统计学和数据可视化的方法了解数据的缺失情况、异常情况、数据分布以及数据相关性情况。为后面特征工程提供参考。

数据范围：区分离散特征和连续特征，并观察特征的取值范围。

数据缺失情况：在评分卡建模中，缺失值是一种非常重要的特征，往往不需要进行填充，而直接进行特征的编码或分箱。除非缺失值占比过多，则可以考虑少出该特征。

数据异常情况：评分卡建模中，特征分箱可以将异常值作为一箱，或者衍生一个异常值表示特征，特征异常时取1，不是异常取0。在反欺诈模型中，异常值是非常重要的特征。反欺诈的目的就是找到与正常行为相违背的少数样本，反映在特征上就是偏离正常范围的异常样本。

变量分布情况：分析是否存在样本不均衡问题。

### 3.2 特征编码

#### 3.2.1 无监督编码（One-hot）

#### 3.2.2 有监督编码（WOE）

#### 3.2.3 WOE与One-hot的比较



### 3.3 特征分箱

#### 3.3.1 特征分箱流程

#### 3.3.2 Chi-merge卡方分箱

#### 3.3.3 Best-KS分箱

#### 3.3.4 最优IV分箱

#### 3.3.5 基于树的最优分箱



### 3.4 特征选择

#### 3.4.1 过滤法

#### 3.4.2 包装法

#### 3.4.3 嵌入法



### 3.5 逻辑回归

#### 3.5.1 模型原理

#### 3.5.2 过拟合与欠拟合



### 3.6 评估指标

#### 3.6.1 正负样本的选择

#### 3.6.2 标准评估指标

#### 3.6.3 概率密度评估指标

#### 3.6.4 概率分布评估指标



### 3.7 评分卡构建

#### 3.7.1 由概率到分数的转换

#### 3.7.2 变量的分值计算

#### 3.7.3 评分卡性能评估



### 3.8 模型监控

#### 3.8.1 稳定性监控

#### 3.8.2 单调性监控

#### 3.8.3 性能监控指标



## 四、评分卡实战进阶

### 样本不均衡处理

### 特征工程进阶

### 决策树模型

### 神经网络模型

### 支持向量机

### 集成学习

### 模型融合



## 五、Lending Club 数据集实战





